== Задания

=== Диспетчер памяти

==== События

События, которые должен обработать диспетчер памяти, и порядок их обработки.

После обработки каждого события необходимо упорядочить свободные блоки согласно
заданной дисциплине.

===== Создание нового процесса

.Ограничения:

* Процесс с таким PID не должен существовать (иными словами, процессу не
  выделен ни один блок памяти)

* Свободной памяти должно быть не меньше, чем требуется процессу

.Алгоритм обработки события:

. Проверить, есть ли свободный блок подходящего размера. Если есть, то выделить
  процессу память в этом блоке и завершить алгоритм

. Если свободного блока подходящего размера нет, но суммарно памяти достаточно,
  то выполнить дефрагментацию, в новом свободном блоке выделить память процессу и
  завершить алгоритм

. В противном случае пропустить заявку

Пошаговая обработка заявки представлена на рисунках ниже.

image::memory-m8t/cp-r-1.png[title="Создание нового процесса - Дефрагментация",caption="",width=512]

image::memory-m8t/cp-r-2.png[title="Создание нового процесса - Выделение блока",caption="",width=512]

image::memory-m8t/cp-r-3.png[title="Создание нового процесса - Ввод данных",caption="",width=512]

image::memory-m8t/cp-r-4.png[title="Создание нового процесса - Конечный результат",caption="",width=512]

<<<

===== Завершение процесса

.Ограничения:

* Процесс с таким PID должен существовать (иными словами, процессу выделен хотя
  бы один блок памяти)

.Алгоритм обработки события:

. Найти все блоки памяти, выделенные данному процессу

. Освободить эти блоки

. Объединить, если такие есть, соседние свободные блоки

Пошаговая обработка заявки представлена на рисунках ниже.

image::memory-m8t/tp-r-1.png[title="Завершение процесса - Освобождение блока",caption="",width=512]

image::memory-m8t/tp-r-2.png[title="Завершение процесса - Освобождение блока",caption="",width=512]

image::memory-m8t/tp-r-3.png[title="Завершение процесса - Объединение блоков",caption="",width=512]

image::memory-m8t/tp-r-4.png[title="Завершение процесса - Конечный результат",caption="",width=512]

<<<

===== Выделение памяти процессу

.Ограничения:

* Процесс с таким PID должен существовать (иными словами, процессу выделен хотя
  бы один блок памяти)

* Свободной памяти должно быть не меньше, чем требуется процессу

Алгоритм обработки события: см. Создание нового процесса.

===== Освобождение памяти

.Ограничения:

* Процесс с таким PID должен существовать (иными словами, процессу выделен хотя
  бы один блок памяти)

* Блок по указанному адресу должен принадлежать данному процессу

.Алгоритм обработки события:

. Освободить блок памяти

. Объединить, если такие есть, соседние свободные блоки

Пошаговая обработка заявки представлена на рисунках ниже.

image::memory-m8t/fm-r-1.png[title="Освобождение памяти - Освобождение блока",caption="",width=512]

image::memory-m8t/fm-r-2.png[title="Освобождение памяти - Конечный результат",caption="",width=512]

==== Дисциплины

.Дисциплины выделения памяти процессам

* Первый подходящий. Свободные блоки памяти сортируются в порядке *увеличения*
  начальных адресов

* Наиболее подходящий. Свободные блоки памяти сортируются по их размерам в
  порядке *возрастания*, а затем в порядке *увеличения* начальных адресов

* Наименее подходящий. Свободные блоки памяти сортируются по их размерам в
  порядке *убывания*, а затем в порядке *увеличения* начальных адресов

<<<

=== Диспетчер процессов

==== Выполнение типовых действий

На рисунках ниже представлено пошаговое выполнение типовых действий в лабораторной установке.

===== Создание нового процесса

image::processes-m8t/cp-r-1.png[title="Создание нового процесса - Вызов контекстного меню",caption="",width=512]

image::processes-m8t/cp-r-2.png[title="Создание нового процесса - Ввод данных",caption="",width=512]

image::processes-m8t/cp-r-3.png[title="Создание нового процесса - Конечный результат",caption="",width=512]

<<<

==== Добавление процесса в очередь

image::processes-m8t/ph-1.png[title="Добавление процесса в очередь - Ввод данных",caption="",width=512]

image::processes-m8t/ph-2.png[title="Добавление процесса в очередь - Конечный результат",caption="",width=512]

<<<

==== Извлечение процесса из очереди

image::processes-m8t/pp-1.png[title="Извлечение процесса из очереди - Выбор очереди",caption="",width=512]

image::processes-m8t/pp-2.png[title="Извлечение процесса из очереди - Конечный результат",caption="",width=512]

<<<

==== Изменение состояния процесса

image::processes-m8t/cs-1.png[title="Переключение в состояние \"Ожидание\"",caption="",width=512]

image::processes-m8t/cs-2.png[title="Переключение в состояние \"Исполняется\"",caption="",width=512]

image::processes-m8t/cs-3.png[title="Переключение в состояние \"Готов к исполнению\"",caption="",width=512]

<<<

==== Завершение процесса

image::processes-m8t/tp-r-1.png[title="Завершение процесса - Вызов контекстного меню",caption="",width=512]

image::processes-m8t/tp-r-2.png[title="Завершение процесса - Конечный результат",caption="",width=512]

<<<

==== События

События, которые должен обработать диспетчер процессов, и порядок их обработки.

===== Создание нового процесса

.Ограничения:

* Процесс с таким PID не должен существовать

.Алгоритм обработки события:

. Создать процесс с данными значениями, состояние — `Готов к исполнению`

. Добавить созданный процесс в соответствующую очередь

. Если у созданного процесса приоритет ниже, чем у исполняющегося на данный
  момент, то ничего не делать (алгоритм завершен)

. Если на данный момент некоторый процесс исполняется, то добавить его в
  соответствующую очередь

. Выбрать процесс для исполнения (согласно дисциплине), извлечь его из
  соответствующей очереди

. Переключить его в состояние `Исполняется`

===== Создание дочернего процесса

.Ограничения:

* Процесс с таким PID не должен существовать

* Дочерний процесс может быть порожден только процессом, выполняющимся в данный
  момент

Алгоритм обработки события: см. Создание нового процесса.

===== Завершение процесса

.Ограничения:

* Процесс с таким PID должен существовать

* При завершении процесса удаляются и его дочерние процессы

.Алгоритм обработки события:

. Удалить данный процесс и его дочерние процессы из списка процессов

. Если данный процесс или один из его дочерних процессов был в состоянии
  `Исполняется`, то нужно выполнить переключение на новый процесс (см. п. 3)

. Выбрать процесс для исполнения (согласно дисциплине), извлечь его из
  соответствующей очереди

. Переключить его в состояние `Исполняется`

===== Запрос на ввод/вывод

.Ограничения:

* Процесс с таким PID должен существовать

* Процесс должен находится в состоянии `Исполняется`

.Алгоритм обработки события:

. Переключить данный процесс в состояние `Ожидание`

. Выбрать процесс для исполнения (согласно дисциплине), извлечь его из
  соответствующей очереди

. Переключить его в состояние `Исполняется`

===== Завершение ввода/вывода

.Ограничения:

* Процесс с таким PID должен существовать

* Процесс должен находится в состоянии `Ожидание`

.Алгоритм обработки события:

. Добавить данный процесс в соответствующую очередь

. Переключить его в состояние `Готов к исполнению`

. Если у данного процесса приоритет ниже, чем у исполняющегося на данный
  момент, то ничего не делать (алгоритм завершен)

. Если на данный момент некоторый процесс исполняется, то добавить его в
  соответствующую очередь

. Выбрать процесс для исполнения (согласно дисциплине), извлечь его из
  соответствующей очереди

. Переключить его в состояние `Исполняется`

===== Передача управления операционной системе

.Ограничения:

* Процесс с таким PID должен существовать

* Процесс должен находится в состоянии `Исполняется`

.Алгоритм обработки события:

. Добавить данный процесс в соответствующую очередь

. Выбрать процесс для исполнения (согласно дисциплине), извлечь его из
  соответствующей очереди

. Переключить его в состояние `Исполняется`

===== Истечение кванта времени

.Алгоритм обработки события:

. Добавить исполняемый на данный момент процесс в соответствующую очередь

. Выбрать процесс для исполнения (согласно дисциплине), извлечь его из
  соответствующей очереди

. Переключить его в состояние `Исполняется`

==== Дисциплины

.Невытесняющие дисциплины:

* First Come First Serve (FCFS)

* Shortest Job Next (SJN)

* Shortest Remaining Time (SRT)

.Вытесняющие дисциплины:

* Round-robin (RR)

* Windows NT

* Unix

* Linux O(1)

===== Round-robin

Используется только очередь 0, которая заполняется в порядке прибывания.
Отсутствуют какие-либо приоритеты.

===== First Come First Serve

Аналогична RoundRobin, за исключением того, что новые процессы добавляются в
очередь 1.

===== Shortest Job Next

Используется только очередь 0. После помещения процесса в очередь необходимо
переместить его на соответствующее место. Для дисциплины SJN вперед помещаются
процессы с меньшим заданным временем выполнения. При этом, если время
выполнения процесса превышает заданное, ему назначается штраф. При помещении
в очередь такой процесс не перемещается, а остальные процессы, даже с большим
временем, при помещении в очередь ставятся перед ним.

===== Shortest Remaining Time

Аналогична SJN, за исключением того, что в очередь вперед помещаются процессы
с меньшим оставшимся временем выполнения.

===== Windows NT

При добавлении процесса в очередь его приоритет уменьшается на единицу, при
этом приоритет не может быть меньше базового приоритета.

По завершении операций ввода/вывода ожидающему процессу назначается некоторая
добавка к приоритету (он помещается в более приоритетную очередь).

===== Unix

Чем дольше работает процесс без операций ввода/вывода, тем меньше становится
его приоритет (уменьшается каждые 2 такта на 1). По завершении ввода/вывода
приоритет увеличивается на 1. Приоритеты 0-7 - динамические,
8-15 - статические.

При создании процесса или при завершении ввода/вывода процесса с более высоким
приоритетом, чем у активного, переключение на данный процесс не происходит.

При истечении кванта времени или передаче управления ОС процессорное время
передается процессу с высшим приоритетом, стоящим первым в очереди с самым
высоким приоритетом.

===== Linux O(1)

Используются две очереди: 0 - "активная" и 1 - "просроченная". В "активную"
очередь добавляются новые процессы, а также процессы, которые завершили
ввод-вывод или передали управление ОС. В "просроченную" очередь добавляются
процессы, которые не уложились в отведенный квант времени.

При выборе процесса для запуска используют следующий алгоритм:

. Если "активная" очередь пуста, то перенести в нее все процессы из
  "просроченной" очереди

. Извлечь из "активной" очереди процесс и запустить его
